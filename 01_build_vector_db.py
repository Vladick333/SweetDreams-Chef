import os
import json
import joblib

print("--- Инициализация 'Нейротьма' v9.0 (Vector Search) ---")
print("--- Создание Векторной Базы Десертов (12 Концептов) ---")

# --- 1. ЭТО МОЗГ "НЕЙРОТЬМЫ" ---
# "Экспертные" оценки (от 0 до 10) для каждого десерта по 12 "Концептам Вкуса".
CONCEPTUAL_FEATURES = [
    "Сладость", "Шоколад", "Фрукты/Ягоды", "Крем/Сливки",
    "Тесто/Выпечка", "Кофе/Чай", "Орехи", "ПП/Веган",
    "Без Глютена", "Без Лактозы", "Холодное", "Экзотика"
]

# --- 2. ЭТО "ЛОГИКА" (ВСТРОЕНА В ДАННЫЕ) ---
# (0 = Нет, 5 = Иногда, 10 = Точно Да)
DESSERT_PROFILES = {
    # --- ПП / Веган / Диета ---
    "Финиковые трюфели": [5, 8, 0, 0, 0, 0, 9, 10, 10, 10, 0, 0],
    "Брауни с черной фасолью": [7, 9, 0, 0, 0, 0, 0, 10, 10, 0, 0, 3],
    "Яблочный зефир": [6, 0, 8, 0, 0, 0, 0, 10, 10, 10, 0, 0],
    "Чиа-пудинг на кокосовом молоке": [4, 0, 9, 0, 0, 0, 0, 10, 10, 10, 0, 3],
    "Чизкейк со стевией": [6, 0, 0, 9, 0, 0, 0, 8, 0, 0, 0, 0],
    "Морковный торт": [7, 0, 2, 7, 6, 0, 6, 8, 0, 0, 0, 0],
    "Ягодный мармелад": [6, 0, 10, 0, 0, 0, 0, 10, 10, 10, 0, 0],

    # --- Тренды / Экзотика ---
    "Дубайский шоколад": [9, 10, 0, 2, 0, 0, 10, 0, 0, 0, 0, 10],
    "Cake pops": [9, 7, 0, 5, 6, 0, 0, 0, 0, 0, 0, 8],
    "Моти": [7, 0, 5, 5, 0, 0, 0, 0, 10, 0, 0, 10],
    "Raindrop cake": [2, 0, 0, 0, 0, 0, 0, 5, 10, 10, 0, 10],
    "Матча-ролл": [6, 0, 0, 8, 6, 10, 0, 0, 0, 0, 0, 8],
    "Десерт с панданом": [7, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 10],
    "Круффин": [8, 3, 3, 5, 10, 0, 0, 0, 0, 0, 0, 9],
    "Трюфели с лавандой": [8, 9, 0, 7, 0, 0, 0, 0, 0, 0, 0, 10],
    "Тарт с розмарином": [6, 0, 5, 5, 7, 0, 0, 0, 0, 0, 0, 10],

    # --- Классика / Тесто ---
    "Ореховый крамбл": [8, 0, 7, 0, 7, 0, 8, 0, 0, 0, 0, 0],
    "Ватрушка": [7, 0, 0, 7, 9, 0, 0, 0, 0, 0, 0, 0],
    "Пари-Брест": [8, 0, 0, 10, 8, 0, 8, 0, 0, 0, 0, 0],
    "Тарт фруте": [7, 0, 9, 7, 8, 0, 0, 0, 0, 0, 0, 0],
    "Макаронс": [9, 2, 3, 5, 0, 0, 8, 0, 10, 0, 0, 0],
    "Шакер-пури": [8, 0, 0, 0, 9, 0, 5, 0, 0, 0, 0, 0],
    "Медовик": [9, 0, 0, 8, 10, 0, 0, 0, 0, 0, 0, 0],
    "Имбирные пряники": [8, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0],
    "Пахлава": [10, 0, 0, 0, 9, 0, 10, 0, 0, 0, 0, 5],
    "Чак-чак": [10, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0],
    "Дакуаз": [9, 0, 0, 9, 0, 0, 10, 0, 10, 0, 0, 0],
    "Блинный торт": [8, 2, 3, 8, 7, 0, 0, 0, 0, 0, 0, 0],
    "Крокембуш": [9, 0, 0, 9, 9, 0, 0, 0, 0, 0, 0, 0],
    "Эклер": [8, 3, 0, 9, 9, 0, 0, 0, 0, 0, 0, 0],
    "Шу": [7, 2, 0, 9, 9, 0, 0, 0, 0, 0, 0, 0],
    "Профитроль": [7, 3, 0, 9, 9, 0, 0, 0, 0, 0, 0, 0],
    "Кекс с повидлом": [8, 0, 7, 0, 9, 0, 0, 0, 0, 0, 0, 0],
    "Творожная запеканка": [7, 0, 2, 7, 0, 0, 0, 0, 0, 0, 0, 0],
    "Мильфей": [9, 0, 6, 10, 10, 0, 0, 0, 0, 0, 0, 0],
    "Наполеон": [9, 0, 0, 10, 10, 0, 0, 0, 0, 0, 0, 0],
    "Молочная девочка": [9, 0, 0, 10, 8, 0, 0, 0, 0, 0, 0, 0],
    "Пончики": [9, 3, 2, 3, 10, 0, 0, 0, 0, 0, 0, 0],

    # --- Шоколад / Кофе ---
    "Тирамису": [8, 5, 0, 10, 3, 10, 0, 0, 0, 0, 0, 0],
    "Шоколадный трюфель": [9, 10, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0],
    "Торт Зебра": [8, 8, 0, 5, 9, 0, 0, 0, 0, 0, 0, 0],
    "Торт Белый лес": [9, 7, 5, 9, 8, 0, 0, 0, 0, 0, 0, 0],
    "Шоколадный фондан": [9, 10, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0],
    "Торт Прага": [9, 10, 0, 8, 9, 0, 0, 0, 0, 0, 0, 0],

    # --- Холодное / Кремы / Желе ---
    "Сорбет": [7, 0, 10, 0, 0, 0, 0, 10, 10, 10, 10, 0],
    "Пломбир": [9, 0, 0, 10, 0, 0, 0, 0, 0, 0, 10, 0],  # << Шоколад: 0, Без Лактозы: 0
    "Крем-брюле": [9, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0],  # << Шоколад: 0
    "Парфе": [8, 0, 7, 9, 0, 0, 0, 0, 0, 0, 10, 0],
    "Ванильная панна-котта": [8, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0],
    "Лимонный курд": [7, 0, 10, 7, 0, 0, 0, 0, 0, 0, 0, 0],
    "Ананасовый курд": [7, 0, 10, 7, 0, 0, 0, 0, 0, 0, 0, 5],
    "Кокосовый мусс": [8, 0, 0, 9, 0, 0, 0, 0, 0, 5, 0, 8],
    "Персиковое суфле": [7, 0, 9, 5, 0, 0, 0, 0, 0, 0, 0, 0],
    "Меренговый рулет": [9, 0, 8, 9, 0, 0, 0, 0, 10, 0, 0, 0]
}

# --- 3. Настройка Папок (v9) ---
MODELS_DIR = "models"
os.makedirs(MODELS_DIR, exist_ok=True)
FEATURES_PATH = os.path.join(MODELS_DIR, "features_v9_concepts.json")
VECTORS_PATH = os.path.join(MODELS_DIR, "dessert_vectors_v9.joblib")

# --- 4. Сохранение Файлов ---
try:
    # Сохраняем список из 12 концептов
    with open(FEATURES_PATH, 'w', encoding='utf-8') as f:
        json.dump(CONCEPTUAL_FEATURES, f, ensure_ascii=False, indent=2)
    print(f"1. Список концептов сохранен в {FEATURES_PATH}")

    # Сохраняем словарь { "Имя": [вектор] }
    joblib.dump(DESSERT_PROFILES, VECTORS_PATH)
    print(f"2. Векторная база десертов ({len(DESSERT_PROFILES)} шт.) сохранена в {VECTORS_PATH}")

    print("\n--- Векторная База 'Нейротьма v9.0' (Vector) успешно создана! ---")
    print("Теперь можно запускать 'streamlit run app.py'")

except Exception as e:
    print(f"\n--- ОШИБКА ---")
    print(f"Не удалось создать файлы: {e}")